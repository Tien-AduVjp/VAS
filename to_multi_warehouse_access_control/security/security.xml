<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data noupdate="0">
		<record id="group_stock_own_document_user" model="res.groups">
			<field name="name">Users: Own Documents</field>
			<field name="category_id"
				ref="base.module_category_inventory_inventory" />
			<field name="implied_ids" eval="[(4, ref('base.group_user'))]" />
			<field name="comment">Who can view and handle stock documents related to
				stock locations and warehouse that they have access rights
			</field>
		</record>

		<record id="group_warehouse_manager" model="res.groups">
			<field name="name">Warehouse Manager</field>
			<field name="category_id"
				ref="base.module_category_inventory_inventory" />
			<field name="implied_ids"
				eval="[(4, ref('group_stock_own_document_user'))]" />
			<field name="comment">Who can view and handle all stock documents related
				to stock locations and warehouse that they have access rights
			</field>
		</record>

		<record id="stock.group_stock_user" model="res.groups">
			<field name="name">All Warehouses Manager</field>
			<field name="category_id"
				ref="base.module_category_inventory_inventory" />
			<field name="implied_ids"
				eval="[(4, ref('group_warehouse_manager'))]" />
			<field name="comment">Who can view and handle all stock documents no
				matter what the locations and warehouses are
			</field>
		</record>
	</data>

	<data noupdate="0">

		<!-- Stock User: Own Documents Rules -->
		<record model="ir.rule" id="stock_move_own_document_user_rule">
			<field name="name">Stock Move Own Documents User Rule</field>
			<field name="model_id" ref="stock.model_stock_move" />
			<field name="groups"
				eval="[(6,0,[ref('to_multi_warehouse_access_control.group_stock_own_document_user')])]" />
			<field name="domain_force">[
				'|','|',('location_id.access_user_ids', 'in',
				[user.id]),
				('location_dest_id.access_user_ids', 'in', [user.id]),
				'&amp;',('location_id.access_user_ids', '=',
				False),('location_dest_id.access_user_ids', '=', False)]
			</field>
			<field eval="1" name="perm_read" />
			<field eval="1" name="perm_write" />
			<field eval="0" name="perm_unlink" />
			<field eval="1" name="perm_create" />
		</record>

        <record id="stock_move_line_own_document_user_rule" model="ir.rule" >
            <field name="name">Stock Move Line Own Documents User Rule</field>
            <field name="model_id" ref="stock.model_stock_move_line" />
            <field name="groups"
                eval="[(6,0,[ref('to_multi_warehouse_access_control.group_stock_own_document_user')])]" />
            <field name="domain_force">[
                '|','|',('location_id.access_user_ids', 'in',
                [user.id]),
                ('location_dest_id.access_user_ids', 'in', [user.id]),
                '&amp;',('location_id.access_user_ids', '=',
                False),('location_dest_id.access_user_ids', '=', False)]
            </field>
        </record>

        <record id="stock_quant_own_document_user_rule" model="ir.rule">
            <field name="name">Stock Quant Own Documents User Rule</field>
            <field name="model_id" ref="stock.model_stock_quant" />
            <field name="groups"
                eval="[(6,0,[ref('to_multi_warehouse_access_control.group_stock_own_document_user')])]" />
            <field name="domain_force">[
                '|',('location_id.access_user_ids', 'in', [user.id]),
                ('location_id.access_user_ids', '=', False)]
            </field>
        </record>

        <record id="stock_account_val_own_document_user_rule" model="ir.rule">
            <field name="name">Stock Valuation Layer Own Documents User Rule</field>
            <field name="model_id" ref="stock_account.model_stock_valuation_layer" />
            <field name="groups"
                eval="[(6,0,[ref('to_multi_warehouse_access_control.group_stock_own_document_user')])]" />
            <field name="domain_force">[
				'|','|',('stock_move_id.location_id.access_user_ids', 'in',[user.id]),
				('stock_move_id.location_dest_id.access_user_ids', 'in', [user.id]),
				'&amp;',('stock_move_id.location_id.access_user_ids', '=', False),
                ('stock_move_id.location_dest_id.access_user_ids', '=', False)]
            </field>
        </record>

        <record id="stock_warehouse_own_document_user_rule" model="ir.rule">
            <field name="name">Stock Warehouse Own Documents User Rule</field>
            <field name="model_id" ref="stock.model_stock_warehouse" />
            <field name="groups"
                eval="[(6,0,[ref('to_multi_warehouse_access_control.group_stock_own_document_user')])]" />
            <field name="domain_force">['|', ('access_user_ids', 'in', [user.id]), ('access_user_ids', '=', False)]</field>
        </record>

        <record id="stock_location_own_document_user_rule" model="ir.rule">
            <field name="name">Stock Location Own Documents User Rule</field>
            <field name="model_id" ref="stock.model_stock_location" />
            <field name="groups"
                eval="[(6,0,[ref('to_multi_warehouse_access_control.group_stock_own_document_user')])]" />
            <field name="domain_force">['|', ('access_user_ids', 'in', [user.id]), ('access_user_ids', '=', False)]</field>
        </record>

		<record model="ir.rule"
			id="stock_picking_own_document_user_rule">
			<field name="name">Stock Picking Own Documents User Rule</field>
			<field name="model_id" ref="stock.model_stock_picking" />
			<field name="groups"
				eval="[(6,0,[ref('to_multi_warehouse_access_control.group_stock_own_document_user')])]" />
			<field name="domain_force">[
				'|','|',('location_id.access_user_ids','in',[user.id]),
				('location_dest_id.access_user_ids','in',[user.id]),
				'&amp;',('location_id.access_user_ids','=',False),('location_dest_id.access_user_ids','=',False)]
			</field>
			<field eval="1" name="perm_read" />
			<field eval="1" name="perm_write" />
			<field eval="1" name="perm_unlink" />
			<field eval="1" name="perm_create" />
		</record>

		<record model="ir.rule"
			id="stock_picking_type_own_document_user_rule">
			<field name="name">Stock Picking Type Own Documents User Rule</field>
			<field name="model_id" ref="stock.model_stock_picking_type" />
			<field name="groups"
				eval="[(6,0,[ref('to_multi_warehouse_access_control.group_stock_own_document_user')])]" />
			<field name="domain_force">[
				'|',
				('warehouse_id.access_user_ids','in', [user.id]),
				('warehouse_id.access_user_ids','=',False)]
			</field>
			<field eval="1" name="perm_read" />
			<field eval="0" name="perm_write" />
			<field eval="0" name="perm_unlink" />
			<field eval="0" name="perm_create" />
		</record>

		<record model="ir.rule"
			id="stock_inventory_own_document_user_rule">
			<field name="name">Stock Inventory Own Documents User Rule</field>
			<field name="model_id" ref="stock.model_stock_inventory" />
			<field name="groups"
				eval="[(6,0,[ref('to_multi_warehouse_access_control.group_stock_own_document_user')])]" />
			<field name="domain_force">[
				'|',('location_ids.access_user_ids','in',[user.id]),('location_ids.access_user_ids','=',False)]
			</field>
			<field eval="1" name="perm_read" />
			<field eval="1" name="perm_write" />
			<field eval="0" name="perm_unlink" />
			<field eval="1" name="perm_create" />
		</record>

		<record model="ir.rule" id="stock_scrap_own_document_user_rule">
			<field name="name">Stock Scrap Own Documents User Rule</field>
			<field name="model_id" ref="stock.model_stock_scrap" />
			<field name="groups"
				eval="[(6,0,[ref('to_multi_warehouse_access_control.group_stock_own_document_user')])]" />
			<field name="domain_force">[
				'|','|',('location_id.access_user_ids','in',[user.id]),
				('scrap_location_id.access_user_ids', 'in',[user.id]),'&amp;',
				('location_id.access_user_ids','=',False),
				('scrap_location_id.access_user_ids', '=', False)]
			</field>
			<field eval="1" name="perm_read" />
			<field eval="1" name="perm_write" />
			<field eval="0" name="perm_unlink" />
			<field eval="1" name="perm_create" />
		</record>

		<!-- Stock User Rules -->
		<record model="ir.rule" id="stock_move_stock_user_rule">
			<field name="name">Stock Move Stock User Rule</field>
			<field name="model_id" ref="stock.model_stock_move" />
			<field name="groups"
				eval="[(6,0,[ref('stock.group_stock_user')])]" />
			<field name="domain_force">[(1,'=',1)]</field>
			<field eval="1" name="perm_read" />
			<field eval="1" name="perm_write" />
			<field eval="0" name="perm_unlink" />
			<field eval="1" name="perm_create" />
		</record>

        <record id="stock_move_line_stock_user_rule" model="ir.rule" >
            <field name="name">Stock Move Line Stock User Rule</field>
            <field name="model_id" ref="stock.model_stock_move_line" />
            <field name="groups"
                eval="[(6,0,[ref('stock.group_stock_user')])]" />
            <field name="domain_force">[(1,'=',1)]</field>
        </record>

        <record id="stock_quant_stock_user_rule" model="ir.rule">
            <field name="name">Stock Quant Own Documents User Rule</field>
            <field name="model_id" ref="stock.model_stock_quant" />
            <field name="groups"
                eval="[(6,0,[ref('stock.group_stock_user')])]" />
            <field name="domain_force">[(1,'=',1)]</field>
        </record>

        <record id="stock_account_val_stock_user_rule" model="ir.rule">
            <field name="name">Stock Account Valuation Own Documents User Rule</field>
            <field name="model_id" ref="stock_account.model_stock_valuation_layer" />
            <field name="groups"
                eval="[(6,0,[ref('stock.group_stock_user')])]" />
            <field name="domain_force">[(1,'=',1)]</field>
        </record>

        <record id="stock_warehouse_stock_user_rule" model="ir.rule">
            <field name="name">Stock Warehouse Stock User Rule</field>
            <field name="model_id" ref="stock.model_stock_warehouse" />
            <field name="groups"
                eval="[(6,0,[ref('stock.group_stock_user')])]" />
            <field name="domain_force">[(1,'=',1)]</field>
        </record>

        <record id="stock_location_stock_user_rule" model="ir.rule">
            <field name="name">Stock Location Stock User Rule</field>
            <field name="model_id" ref="stock.model_stock_location" />
            <field name="groups"
                eval="[(6,0,[ref('stock.group_stock_user')])]" />
            <field name="domain_force">[(1,'=',1)]</field>
        </record>

		<record model="ir.rule" id="stock_picking_stock_user_rule">
			<field name="name">Stock Picking Stock User Rule</field>
			<field name="model_id" ref="stock.model_stock_picking" />
			<field name="groups"
				eval="[(6,0,[ref('stock.group_stock_user')])]" />
			<field name="domain_force">[(1,'=',1)]</field>
			<field eval="1" name="perm_read" />
			<field eval="1" name="perm_write" />
			<field eval="1" name="perm_unlink" />
			<field eval="1" name="perm_create" />
		</record>

		<record model="ir.rule" id="stock_picking_type_stock_user_rule">
			<field name="name">Stock Picking Type Stock User Rule</field>
			<field name="model_id" ref="stock.model_stock_picking_type" />
			<field name="groups"
				eval="[(6,0,[ref('stock.group_stock_user')])]" />
			<field name="domain_force">[(1,'=',1)]</field>
			<field eval="1" name="perm_read" />
			<field eval="0" name="perm_write" />
			<field eval="0" name="perm_unlink" />
			<field eval="0" name="perm_create" />
		</record>

		<record model="ir.rule" id="stock_inventory_stock_user_rule">
			<field name="name">Stock Inventory Stock User Rule</field>
			<field name="model_id" ref="stock.model_stock_inventory" />
			<field name="groups"
				eval="[(6,0,[ref('stock.group_stock_user')])]" />
			<field name="domain_force">[(1,'=',1)]</field>
			<field eval="1" name="perm_read" />
			<field eval="1" name="perm_write" />
			<field eval="0" name="perm_unlink" />
			<field eval="1" name="perm_create" />
		</record>

		<record model="ir.rule" id="stock_scrap_stock_user_rule">
			<field name="name">Stock Scrap Stock User Rule</field>
			<field name="model_id" ref="stock.model_stock_scrap" />
			<field name="groups"
				eval="[(6,0,[ref('stock.group_stock_user')])]" />
			<field name="domain_force">[(1,'=',1)]</field>
			<field eval="1" name="perm_read" />
			<field eval="1" name="perm_write" />
			<field eval="0" name="perm_unlink" />
			<field eval="1" name="perm_create" />
		</record>
	</data>
</odoo>
