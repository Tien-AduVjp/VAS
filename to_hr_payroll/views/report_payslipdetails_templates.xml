<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<template id="report_payslipdetails">
		<t t-call="web.html_container">
			<t t-foreach="docs" t-as="o">
				<t t-call="web.external_layout">
					<div class="page">
						<h2>Pay Slip</h2>
						<p t-field="o.name" />
                        <!-- As normal employee may not have access rights to read some data in employee model,
                        sudo is implemented here to avoid access error when the employee prints his own payslip
                        -->
                        <t t-set="employee" t-value="o.employee_id.sudo()" />
						<table class="table table-sm table-bordered">
							<tr>
								<td>
									<strong>Name</strong>
								</td>
								<td>
									<span t-field="o.employee_id" />
								</td>
								<td>
									<strong>Job Position</strong>
								</td>
								<td>
									<span t-field="employee.job_id" />
								</td>
							</tr>
							<tr>
								<td>
									<strong>Address</strong>
								</td>
								<td colspan="3">
									<div t-field="employee.address_home_id"
										t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True, "phone_icons": True}' />
								</td>
							</tr>
							<tr>
								<td>
									<strong>Email</strong>
								</td>
								<td>
									<span t-field="employee.work_email" />
								</td>
								<td>
									<strong>Identification No</strong>
								</td>
								<td>
									<span t-field="employee.identification_id" />
								</td>
							</tr>
							<tr>
								<td>
									<strong>Reference</strong>
								</td>
								<td>
									<span t-field="o.number" />
								</td>
								<td>
									<strong>Bank Account</strong>
								</td>
								<td>
									<span t-field="employee.bank_account_id" />
									<t
										t-if="employee.bank_account_id and employee.bank_account_id.bank_id">
										|
										<span t-field="employee.bank_account_id.bank_id" />
									</t>
								</td>
							</tr>
							<tr>
								<td>
									<strong>Date From</strong>
								</td>
								<td>
									<span t-field="o.date_from" />
								</td>
								<td>
									<strong>Date To</strong>
								</td>
								<td>
									<span t-field="o.date_to" />
								</td>
							</tr>
						</table>

						<h3>Details by Salary Rule Category</h3>
						<table class="table table-sm mb32">
							<thead>
								<tr>
									<th>Code</th>
									<th>Salary Rule Category</th>
									<th class="text-right">Total</th>
								</tr>
							</thead>
							<tbody>
								<tr t-foreach="get_details_by_rule_category.get(o.id, [])"
									t-as="h">
									<td>
										<span t-esc="h['code']" />
									</td>
									<td>
										<span t-esc="'..'*h['level']" />
										<span t-esc="h['rule_category']" />
									</td>
									<td class="text-right">
										<span t-esc="h['total']"
											t-options='{"widget": "monetary", "display_currency": o.currency_id}' />
									</td>
								</tr>
							</tbody>
						</table>

						<h3>Payslip Lines by Contribution Register</h3>
						<table class="table table-sm mt32">
							<thead>
								<tr>
									<th>Code</th>
									<th>Name</th>
									<th class="text-right">Quantity/rate</th>
									<th class="text-right">Amount</th>
									<th class="text-right">Total</th>
								</tr>
							</thead>
							<tbody>
								<tr
									t-foreach="get_lines_by_contribution_register.get(o.id, [])"
									t-as="p">
									<td>
										<span t-esc="p.get('code', '')" />
									</td>
									<td>
										<span t-esc="p.get('name', '')" />
									</td>
									<td class="text-right">
										<span t-esc="p.get('quantity', '')" />
									</td>
									<td class="text-right">
										<span t-esc="p.get('amount', 0)" />
									</td>
									<td class="text-right">
										<span t-esc="p.get('total', 0)"
											t-options='{"widget": "monetary", "display_currency": o.currency_id}' />
									</td>
								</tr>
							</tbody>
						</table>

						<p class="text-right">
							<strong>Authorized signature</strong>
						</p>
					</div>
				</t>
			</t>
		</t>
	</template>
</odoo>
