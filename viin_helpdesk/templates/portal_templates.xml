<odoo>
	<template id="portal_breadcrumbs" name="Portal layout: menu entry" inherit_id="portal.portal_breadcrumbs" priority="40">
		<xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
			<li t-if="page_name == 'tickets' or ticket" t-attf-class="breadcrumb-item #{'active ' if not ticket else ''}">
				<a t-attf-href="/my/tickets?{{ keep_query() }}">Tickets</a>
			</li>
			<li t-if="ticket" class="breadcrumb-item active">
				<span t-field="ticket.name" /> (#<span t-field="ticket.id" />)
			</li>
		</xpath>
	</template>

	<!-- Ticket Count -->

	<template id="portal_my_home" inherit_id="portal.portal_my_home">
		<xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
			<t t-call="portal.portal_docs_entry">
				<t t-set="title">Tickets</t>
				<t t-set="url" t-value="'/my/tickets/'" />
				<t t-set="count" t-value="tickets_count" />
			</t>
		</xpath>
	</template>

	<!-- Show All Ticket -->

	<template id="portal_my_tickets" name="My Tickets">
		<t t-call="portal.portal_layout">
			<t t-set="breadcrumbs_searchbar" t-value="True" />
			<t t-call="portal.portal_searchbar">
				<t t-set="title">Tickets</t>
			</t>

			<!-- Show "Create" Button of Tickets on the Portal -->

			<div class="row" style="padding-left: 15px; padding-right: 15px;">
				<a id="btn_create_ticket" t-attf-href="{{create_ticket_url}}" class="btn btn-primary mt-0 mb-2 col-2">Create Ticket</a>
			</div>
			<div class="ticket-list">
				<t t-if="grouped_tickets">
					<t t-call="portal.portal_table">
						<t t-foreach="grouped_tickets" t-as="tickets">
							<thead>
								<tr t-attf-class="{{'thead-light' if not groupby == 'none' else ''}}">
									<th class="text-left" width="10%">Ref</th>
									<th width="40%">
										<t t-if="groupby == 'team'">
											<em class="font-weight-normal text-muted">
												Tickets for team:
											</em>
											<span t-field="tickets[0].sudo().team_id.name" />
										</t>
										<t t-elif="groupby == 'partner'">
											<em class="font-weight-normal text-muted">
												Tickets for partner:
											</em>
											<span t-field="tickets[0].sudo().partner_id.name" />
										</t>
										<t t-elif="groupby == 'stage'">
											<em class="font-weight-normal text-muted">
												Tickets in stage:
											</em>
											<span t-field="tickets[0].sudo().stage_id.name" />
										</t>
										<t t-else="">
											Title
										</t>
									</th>
									<th class="text-left">Partner</th>
									<th class="text-center">Stage</th>
									<th class="text-left">Create Date</th>
								</tr>
							</thead>
							<tbody>
								<t t-foreach="tickets" t-as="ticket">
									<tr>
										<td class="text-left">
											#
											<span t-esc="ticket.id" />
										</td>
										<td class="text-truncate">
											<a t-attf-href="/my/tickets/#{ticket.id}?{{ keep_query() }}">
												<span t-field="ticket.name" /> (#<span t-field="ticket.id" />)
											</a>
										</td>
										<td class="text-left">
											<span t-field="ticket.partner_id" />
										</td>
										<td class="text-center">
											<span class="badge badge-pill badge-info" title="Current stage of the ticket" t-esc="ticket.stage_id.name" />
										</td>
										<td class="text-left">
											<span t-esc="ticket.create_date.replace(microsecond = 0)" />
										</td>
									</tr>
								</t>
							</tbody>
						</t>
					</t>
				</t>
				<t t-else="">
					<div class="alert alert-warning mt8" role="alert">
						There are no tickets.
					</div>
				</t>
			</div>
		</t>
		
							
	</template>

	<!-- Show Ticket Form Portal -->

	<template id="portal_my_ticket" name="Create Ticket">
		<t t-call="portal.portal_layout">
			<t t-call="portal.portal_record_layout">
				<t t-set="card_header">
					<div class="row no-gutters">
						<div class="col-md">
							<h5 class="mb-1 mb-md-0">
								<span t-field="ticket.name" /> (#<span t-field="ticket.id" />)
							</h5>
						</div>
						<div class="col-md text-md-right">
							<small class="text-right">Status:</small>
							<span t-field="ticket.stage_id.name" class=" badge badge-pill badge-info ticket-status" title="Current stage of this ticket" />
						</div>
					</div>
				</t>
				<t t-set="card_body">					
					<div class="row mb-4">
						<div class="col-12 col-md-6">
							<strong t-attf-class="#{'' if ticket.team_id else 'd-none'}">Team:</strong>
							<span t-attf-class="#{'' if ticket.team_id else 'd-none'}" t-field="ticket.team_id.name" />
							<br />
							<strong t-attf-class="#{'' if ticket.ticket_type_id else 'd-none'}">Ticket Type:</strong>
							<span t-attf-class="#{'' if ticket.ticket_type_id else 'd-none'}" t-field="ticket.ticket_type_id" />
						</div>
						<div class="col-12 col-md-6">
							<strong>Create Date:</strong>
							<span t-field="ticket.create_date" t-options='{"widget": "datetime"}' />
							<br />
							<t t-if="ticket.end_date">
								<strong>Done Date:</strong>
								<span t-field="ticket.end_date" t-options='{"widget": "datetime"}' />
							</t>
						</div>
						<div class="col-12">
							<strong t-attf-class="#{'' if ticket.description else 'd-none'}">Description:</strong>
							<span t-attf-class="#{'' if ticket.description else 'd-none'}" t-field="ticket.description" />
						</div>
					</div>					
					<div class="row mb-4">
						<div class="col-12 col-md-6">
							<strong>Partner:</strong>
							<div class="row">
								<div class="col flex-grow-0 pr-3">
									<img t-if="ticket.partner_id.image_1024" class="rounded-circle mt-1 o_portal_contact_img" 
										t-att-src="image_data_uri(ticket.partner_id.image_1024)" alt="Contact" />
									<img t-else="" class="rounded-circle mt-1 o_portal_contact_img"
										src="/web/static/src/img/user_menu_avatar.png" alt="Contact" />
								</div>
								<div class="col pl-md-0">
									<div t-field="ticket.partner_id" t-options='{"widget": "contact", "fields": ["name", "email", "phone"]}' />
								</div>
							</div>
						</div>
						<div class="col-12 col-md-6" t-if="ticket.user_id">
							<strong>Assign to:</strong>
							<div class="row">
								<div class="col flex-grow-0 pr-3">
									<img t-if="ticket.user_id.image_1024" class="rounded-circle mt-1 o_portal_contact_img"
										t-att-src="image_data_uri(ticket.user_id.image_1024)" alt="Contact" />
									<img t-else="" class="rounded-circle mt-1 o_portal_contact_img"
										src="/web/static/src/img/user_menu_avatar.png" alt="Contact" />
								</div>
								<div class="col pl-md-0">
									<div t-field="ticket.user_id" t-options='{"widget": "contact", "fields": ["name", "email", "phone"]}' />
								</div>
							</div>
						</div>
					</div>
				</t>
			</t>
			<div class="mt32">
				<h4>
					<strong>Message and Communication history</strong>
				</h4>
				<t t-call="portal.message_thread">
					<t t-set="object" t-value="ticket" />
				</t>
			</div>
		</t>
	</template>

	<!-- Create Ticket from Portal -->

	<template id="create_ticket_from_portal" name="Create Ticket">
		<t t-call="portal.portal_layout">
			<t t-call="portal.portal_record_layout">
				<t t-set="card_body">
					<form action="/my/tickets/create" method="post" class="s_website_form js_helpdesk_ticket_portal_form" enctype="multipart/form-data">
						<input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
						<div class="form-group form-field">
							<label for="title_ticket">Title</label>
							<input type="text" class="form-control o_website_form_input" id="title_ticket" name="name" t-att-value="name" placeholder="Title for Ticket" required="1" />
						</div>
						<div class="form-group form-field">
							<span class="form-field">
							<t t-if="teams">
								<label class="col-form-label" for="team_id">Helpdesk Team</label>
								<select name="team_id" class="form-control o_website_form_input" required="1">
									<t t-foreach='teams' t-as='t'>
                						<option t-att-value='t.id'><t t-esc='t.name'/></option>
            						</t>
								</select>
							</t>
							</span>
						</div>
						<div class="form-group alert alert-info helpdesk-team-description">
							<h4><strong>About our team</strong></h4>
							<span></span>
						</div>
						<div class="form-group form-field">
							<label for="description_for_ticket">Description</label>
							<textarea id="description_ticket" class="form-control o_website_form_input" name="description" t-att-value="description"
								placeholder="Description for Ticket" cols="74" rows="5" required="1"></textarea>
						</div>
						<div class="form-group">
							<label for="attachment_ids">Attachments</label>
							<input id="attachment_ids" type="file" 
								name="attachment_ids" class="form-control s_website_form_input" multiple="true" accept="image/*" />
						</div>
						<div class="row" style="padding-left: 1em; padding-right: 1em;">
							<button id="submit" class="btn btn-primary col-2" style="margin-top:0.5em;">Submit</button>
							<a href="/my/tickets" data-toggle="tooltip" title="Return URL: /my/tickets/" class="btn btn-primary col-2 offset-8" 
							style="margin-top:0.5em;">Cancel</a>
						</div>
					</form>
				</t>
			</t>
		</t>
	</template>
</odoo>