<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data noupdate="0">
		<!-- NEW RULES -->
		<record model="ir.rule" id="personal_project_project_user_rule">
			<field name="name">Project Users: personal projects</field>
			<field name="model_id" ref="project.model_project_project" />
			<field name="groups"
				eval="[(4, ref('project.group_project_user'))]" />
			<field name="domain_force">[('user_id','=',user.id), ('project_user_full_access_rights', '=', True)]</field>
			<field name="perm_read" eval="0" />
			<field name="perm_write" eval="1" />
			<field name="perm_create" eval="1" />
			<field name="perm_unlink" eval="1" />
		</record>

		<record model="ir.rule"
			id="personal_project_task_project_user_rule">
			<field name="name">Project Users: personal project tasks</field>
			<field name="model_id" ref="project.model_project_task" />
			<field name="groups"
				eval="[(4, ref('project.group_project_user'))]" />
			<field name="domain_force">[
            '|',
                ('project_id.user_id','=',user.id),
                ('project_id.allowed_internal_user_ids', 'in', user.ids),
            ]</field>
			<field name="perm_read" eval="0" />
			<field name="perm_write" eval="1" />
			<field name="perm_create" eval="1" />
			<field name="perm_unlink" eval="1" />
		</record>

		<record model="ir.rule"
			id="personal_project_task_type_own_project_user_rule">
			<field name="name">Project Users: personal project stages</field>
			<field name="model_id" ref="project.model_project_task_type" />
			<field name="groups"
				eval="[(4, ref('project.group_project_user'))]" />
			<field name="domain_force">[('project_ids.user_id','=',user.id)]</field>
			<field name="perm_read" eval="0" />
			<field name="perm_write" eval="1" />
			<field name="perm_create" eval="1" />
			<field name="perm_unlink" eval="1" />
		</record>

		<record model="ir.rule"
			id="follower_project_task_type_own_project_user_rule">
			<field name="name">Project Users: following project stages</field>
			<field name="model_id" ref="project.model_project_task_type" />
			<field name="groups"
				eval="[(4, ref('project.group_project_user'))]" />
			<field name="domain_force">[('project_ids.user_id','!=',user.id),('project_ids.task_ids.user_id','=',user.id)]</field>
			<field name="perm_read" eval="0" />
			<field name="perm_write" eval="1" />
			<field name="perm_create" eval="1" />
			<field name="perm_unlink" eval="1" />
		</record>

		<record model="ir.rule"
			id="personal_project_task_type_admin">
			<field name="name">Project Administrator: all project stages</field>
			<field name="model_id" ref="project.model_project_task_type" />
			<field name="groups"
				eval="[(4, ref('project.group_project_manager'))]" />
			<field name="domain_force">[(1,'=',1)]</field>
			<field name="perm_read" eval="1" />
			<field name="perm_write" eval="1" />
			<field name="perm_create" eval="1" />
			<field name="perm_unlink" eval="1" />
		</record>
	</data>
</odoo>
