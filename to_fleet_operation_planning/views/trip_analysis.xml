<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<data>
		<record model="ir.ui.view" id="fleet_trip_analysis_pivot_view">
			<field name="name">fleet.trips.analysis pivot</field>
			<field name="model">fleet.trips.analysis</field>
			<field name="arch" type="xml">
				<pivot string="Fleet Trips Analysis" disable_linking="True">
					<field name="vehicle_id" type="row" />
					<field name="start_date" type="col" />
					<field name="est_distance" type="measure" />
					<field name="operation_duration" type="measure" />
					<field name="sum_cost" type="measure" />
				</pivot>
			</field>
		</record>

		<record model="ir.ui.view" id="fleet_trip_analysis_graph">
			<field name="name">fleet.trips.analysis graph</field>
			<field name="model">fleet.trips.analysis</field>
			<field name="arch" type="xml">
				<graph string="Fleet Trips Analysis">
					<field name="vehicle_id" />
					<field name="operation_duration" type="measure" />
					<field name="time_deviation" type="measure" />
				</graph>
			</field>
		</record>

		<!-- Custom reports (aka filters) -->
		<record id="fleet_trip_analysis_search" model="ir.ui.view">
			<field name="name">fleet.trips.analysis.search</field>
			<field name="model">fleet.trips.analysis</field>
			<field name="arch" type="xml">
				<search string="Search Trips Analysis">
					<field name="vehicle_id" />
					<field name="start_date" />
					<field name="end_date" />
					<field name="route_id" />
					<field name="driver_id" />
					<field name="employee_id" />
					<filter string="This Year" name="thisyear"
						domain="[('start_date','&gt;=',time.strftime('%%Y-01-01'))]"
						help="Trips started within this year" />

					<filter string="Last Year" name="ftr_last_year"
						help="Trips started and ended last year"
						domain="[('start_date','&gt;=',(context_today()-relativedelta(years=1)).strftime('%Y-01-01')),('end_date','&lt;',time.strftime('%Y-01-01'))]" />

					<separator />
					<filter string="In progress" name="ftr_progress"
						domain="[('state','=','progress')]" />
					<filter string="Done" name="ftr_done" domain="[('state','=','done')]" />

					<group expand="0" string="Extended Filters...">
						<field name="vehicle_id" />
						<field name="driver_id" />
						<field name="employee_id" />
						<field name="route_id" />
					</group>
					<group expand="1" string="Group By">
						<filter string="Vehicle" name="grp_vehicle"
							context="{'group_by':'vehicle_id'}" />
						<filter string="Driver" name="group_journal"
							context="{'group_by':'driver_id'}" />
						<filter string="Employee"
							context="{'group_by':'employee_id'}" name="usertype" />
						<filter string="Route" context="{'group_by':'route_id'}" name="grp_route"/>
						<separator />
						<filter string="Starting Month" name="grp_start_month"
							context="{'group_by':'start_date:month'}"
							help="Trips Start Date by Month" />
						<filter string="Ending Month" name="grp_end_month"
							context="{'group_by':'end_date:month'}"
							help="Trips End Date by Month" />
					</group>
				</search>
			</field>
		</record>

		<!-- actions opening views on models -->
		<record model="ir.actions.act_window"
			id="fleet_trip_analysis_action_window">
			<field name="name">Fleet Trips Analysis</field>
			<field name="res_model">fleet.trips.analysis</field>
			<field name="view_mode">pivot,graph</field>
			<field name="context">{'search_default_thisyear':1}</field>
			<field name="help">From this view, have an analysis of your different
				trips against different vehicles over the time.
			</field>
		</record>

		<!-- menu item actions -->

		<menuitem name="Trips Analysis" id="fleet_trip_analysis_menu"
			parent="menu_fleet_trip_reporting"
			action="fleet_trip_analysis_action_window" sequence="5" />

	</data>
</odoo>
